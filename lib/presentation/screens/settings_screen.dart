import 'package:flutter/material.dart';
import 'package:imarket/main.dart';
import 'package:imarket/presentation/screens/login_screen.dart';
import 'package:provider/provider.dart';
import 'package:imarket/services/theme_provider.dart';
import 'legal_content_screen.dart';
import 'change_password_screen.dart';
import 'account_settings_screen.dart';
import 'coming_soon_screen.dart';
import 'blocked_users_screen.dart'; // ุงุณุชูุฑุงุฏ ุดุงุดุฉ ุงููุณุชุฎุฏููู ุงููุญุธูุฑูู

class SettingsScreen extends StatefulWidget {
  const SettingsScreen({super.key});

  @override
  State<SettingsScreen> createState() => _SettingsScreenState();
}

class _SettingsScreenState extends State<SettingsScreen> {
  void _navigateTo(Widget screen) {
    Navigator.push(context, MaterialPageRoute(builder: (context) => screen));
  }

  Future<void> _signOut() async {
    await supabase.auth.signOut();
    if (mounted) {
      Navigator.of(context).pushAndRemoveUntil(
          MaterialPageRoute(builder: (context) => const LoginScreen()),
          (route) => false);
    }
  }

  @override
  Widget build(BuildContext context) {
    final themeProvider = Provider.of<ThemeProvider>(context);

    return Scaffold(
      appBar: AppBar(
        title: const Text('ุงูุฅุนุฏุงุฏุงุช'),
      ),
      body: SingleChildScrollView(
        child: Padding(
          padding:
              const EdgeInsets.symmetric(horizontal: 16.0, vertical: 24.0),
          child: Column(
            children: [
              _buildSettingsSection(
                items: [
                  _buildPickerItem(
                    icon: Icons.public,
                    title: 'ุงูุฏููุฉ',
                    value: 'ุงูุฃุฑุฏู ๐ฏ๐ด',
                    onTap: () {
                      // ูููู ุฅุถุงูุฉ ููุทู ุชุบููุฑ ุงูุฏููุฉ ูุณุชูุจูุงู
                    },
                  ),
                  _buildSwitchItem(
                    icon: Icons.nightlight_round,
                    title: 'ุงููุถุน ุงููููู',
                    value: themeProvider.themeMode == ThemeMode.dark,
                    onChanged: (value) {
                      themeProvider.toggleTheme(value);
                    },
                  ),
                ],
              ),
              const SizedBox(height: 24),
              _buildSettingsSection(
                items: [
                  _buildNavigationItem(
                    icon: Icons.block,
                    title: 'ุงููุณุชุฎุฏููู ุงููุญุธูุฑูู',
                    onTap: () => _navigateTo(const BlockedUsersScreen()),
                  ),
                  _buildNavigationItem(
                    icon: Icons.notifications_none,
                    title: 'ุฅุนุฏุงุฏุงุช ุงูุชูุจููุงุช',
                    onTap: () => _navigateTo(const ComingSoonScreen(featureName: 'ุฅุนุฏุงุฏุงุช ุงูุชูุจููุงุช')),
                  ),
                  _buildNavigationItem(
                    icon: Icons.person_outline,
                    title: 'ุฅุนุฏุงุฏุงุช ุงูุญุณุงุจ',
                    onTap: () => _navigateTo(const AccountSettingsScreen()),
                  ),
                  _buildNavigationItem(
                    icon: Icons.lock_outline,
                    title: 'ุชุนุฏูู ูููุฉ ุงููุฑูุฑ',
                    onTap: () => _navigateTo(const ChangePasswordScreen()),
                  ),
                ],
              ),
              const SizedBox(height: 24),
              _buildSettingsSection(
                items: [
                  _buildNavigationItem(
                    icon: Icons.description_outlined,
                    title: 'ุฅุชูุงููุฉ ุงูุงุณุชุฎุฏุงู',
                    onTap: () => _navigateTo(const LegalContentScreen(
                      title: 'ุฅุชูุงููุฉ ุงูุงุณุชุฎุฏุงู',
                      content: '''
ูุฑุญุจูุง ุจู ูู iMarket JO.

ุจุงุณุชุฎุฏุงูู ูุชุทุจูููุงุ ูุฅูู ุชูุงูู ุนูู ุงูุงูุชุฒุงู ุจูุฐู ุงูุดุฑูุท ูุงูุฃุญูุงู. ุงูุฑุฌุงุก ูุฑุงุกุชูุง ุจุนูุงูุฉ.

1. ูุจูู ุงูุดุฑูุท
ุจุชุณุฌูู ุญุณุงุจ ุฃู ุงุณุชุฎุฏุงู ุงูุชุทุจููุ ูุฅูู ุชูุฑ ุจุฃูู ูุฏ ูุฑุฃุช ููููุช ููุงููุช ุนูู ูุฐู ุงูุงุชูุงููุฉ. ุฅุฐุง ููุช ูุง ุชูุงูู ุนูู ูุฐู ุงูุดุฑูุทุ ูุฌุจ ุนููู ุนุฏู ุงุณุชุฎุฏุงู ุงูุชุทุจูู.

2. ุงุณุชุฎุฏุงู ุงูุชุทุจูู
- ูุฌุจ ุฃู ูููู ุนูุฑู 18 ุนุงููุง ุนูู ุงูุฃูู ูุฅูุดุงุก ุญุณุงุจ ููุดุฑ ุฅุนูุงูุงุช.
- ุฃูุช ุงููุณุคูู ุงููุญูุฏ ุนู ุงูุญูุงุธ ุนูู ุฃูุงู ูููุฉ ุงููุฑูุฑ ุงูุฎุงุตุฉ ุจู ูุนู ุฌููุน ุงูุฃูุดุทุฉ ุงูุชู ุชุญุฏุซ ุชุญุช ุญุณุงุจู.
- ููุณุชุฎุฏู ุงูุชุทุจูู ูุบุฑุถ ุนุฑุถ ูุจูุน ูุดุฑุงุก ุฃุฌูุฒุฉ iPhone ุงููุณุชุนููุฉ ูุงูุฌุฏูุฏุฉ ููุท.

3. ูุณุคูููุงุช ุงููุณุชุฎุฏู
- ุฃูุช ุงููุณุคูู ุงููุญูุฏ ุนู ุฏูุฉ ูุตุญุฉ ุงููุนูููุงุช ุงููุงุฑุฏุฉ ูู ุฅุนูุงูุงุชูุ ุจูุง ูู ุฐูู ุงูุณุนุฑ ูุงูููุงุตูุงุช ูุงูุญุงูุฉ ูุงูุตูุฑ.
- ููููุน ูุดุฑ ุฃู ูุญุชูู ูุถูู ุฃู ุงุญุชูุงูู ุฃู ููุชูู ุญููู ุงูููููุฉ ุงูููุฑูุฉ ููุขุฎุฑูู.
- iMarket JO ูู ููุตุฉ ูุณูุทุฉ ุชุฑุจุท ุจูู ุงูุจุงุฆุนูู ูุงููุดุชุฑูู. ูุญู ูุณูุง ุทุฑููุง ูู ุฃู ูุนุงููุฉ ุจูุน ุฃู ุดุฑุงุก ุชุชู ุจูู ุงููุณุชุฎุฏููู.
- ูุญู ูุง ูุถูู ุฌูุฏุฉ ุฃู ุณูุงูุฉ ุฃู ูุงููููุฉ ุงูุฃุฌูุฒุฉ ุงูููุนูู ุนููุง. ุชุชู ุฌููุน ุงููุนุงููุงุช ุนูู ูุณุคูููุฉ ุงูุฃุทุฑุงู ุงููุนููุฉ.

4. ุงููุญุชูู ุงููุญุธูุฑ
ููููุน ููุนูุง ุจุงุชูุง ูุดุฑ ุฅุนูุงูุงุช ุชุญุชูู ุนูู:
- ุณูุน ูุณุฑููุฉ ุฃู ุบูุฑ ูุงููููุฉ.
- ูุนูููุงุช ุงุชุตุงู ูุฒููุฉ.
- ุตูุฑ ุบูุฑ ุญููููุฉ ุฃู ูุฃุฎูุฐุฉ ูู ุงูุฅูุชุฑูุช ูุง ุชูุซู ุงูุฌูุงุฒ ุงููุนูู.
- ุฃู ูุญุชูู ููุฏู ุฅูู ุงูุชุดููุฑ ุฃู ุงูุฅุณุงุกุฉ ุฃู ุงูุชุญุฑุด ุจูุณุชุฎุฏููู ุขุฎุฑูู.

5. ุงูููุงุท ูุงูุฎุฏูุงุช ุงููุฏููุนุฉ
- ูููุฑ ุงูุชุทุจูู "ููุงุท ุชูููุฒ" ูููู ุงุณุชุฎุฏุงููุง ูููุฒุงุช ุฅุถุงููุฉ ูุซู ุชูููุฒ ุงูุฅุนูุงูุงุช ุฃู ุฑูุนูุง.
- ูุฏ ุชููู ูุฐู ุงูููุงุท ูุฌุงููุฉ ุนูุฏ ุงูุชุณุฌูู ุฃู ูุชู ุดุฑุงุคูุง.
- ุฌููุน ุนูููุงุช ุดุฑุงุก ุงูููุงุท ููุงุฆูุฉ ูุบูุฑ ูุงุจูุฉ ููุงุณุชุฑุฏุงุฏ.

6. ุฅุฎูุงุก ุงููุณุคูููุฉ
- ูุชู ุชูููุฑ ุงูุชุทุจูู "ููุง ูู" ุฏูู ุฃู ุถูุงูุงุช ูู ุฃู ููุน.
- ูุญู ุบูุฑ ูุณุคูููู ุนู ุฃู ุฎุณุงุฆุฑ ุฃู ุฃุถุฑุงุฑ ูุจุงุดุฑุฉ ุฃู ุบูุฑ ูุจุงุดุฑุฉ ูุฏ ุชูุดุฃ ุนู ุงุณุชุฎุฏุงูู ููุชุทุจูู ุฃู ุนู ุฃู ูุนุงููุงุช ุจูู ุงููุณุชุฎุฏููู.

7. ุฅููุงุก ุงูุญุณุงุจ
ูุญุชูุธ ุจุงูุญู ูู ุชุนููู ุฃู ุญุฐู ุฃู ุญุณุงุจ ูุฎุงูู ูุฐู ุงูุดุฑูุท ุฏูู ุณุงุจู ุฅูุฐุงุฑ.

8. ุชุนุฏูู ุงูุดุฑูุท
ูุฏ ูููู ุจุชุญุฏูุซ ูุฐู ุงูุดุฑูุท ูู ููุช ูุขุฎุฑ. ุณูููู ุจุฅุนูุงูู ุจุฃู ุชุบููุฑุงุช ุฌููุฑูุฉ. ุงุณุชูุฑุงุฑู ูู ุงุณุชุฎุฏุงู ุงูุชุทุจูู ุจุนุฏ ุงูุชุญุฏูุซุงุช ูุนูู ููุงููุชู ุนูู ุงูุดุฑูุท ุงูุฌุฏูุฏุฉ.

9. ุงููุงููู ุงูุญุงูู
ุชุฎุถุน ูุฐู ุงูุงุชูุงููุฉ ูุชููุณุฑ ููููุง ูููุงููู ุงูููููุฉ ุงูุฃุฑุฏููุฉ ุงููุงุดููุฉ.

ููุงุณุชูุณุงุฑุงุชุ ูุฑุฌู ุงูุชูุงุตู ูุนูุง.
''',
                    )),
                  ),
                  _buildNavigationItem(
                    icon: Icons.privacy_tip_outlined,
                    title: 'ุณูุงุณุฉ ุงูุฎุตูุตูุฉ',
                    onTap: () => _navigateTo(const LegalContentScreen(
                      title: 'ุณูุงุณุฉ ุงูุฎุตูุตูุฉ',
                      content: '''
ุชูุถุญ ุณูุงุณุฉ ุงูุฎุตูุตูุฉ ูุฐู ููู ูููู ุชุทุจูู iMarket JO ุจุฌูุน ูุงุณุชุฎุฏุงู ูุญูุงูุฉ ูุนูููุงุชู ุงูุดุฎุตูุฉ.

1. ุงููุนูููุงุช ุงูุชู ูุฌูุนูุง
ุฃ. ุงููุนูููุงุช ุงูุชู ุชูุฏููุง ููุง ูุจุงุดุฑุฉู:
- ุนูุฏ ุฅูุดุงุก ุญุณุงุจ: ูุฌูุน ุงุณูู ุงููุงููุ ุนููุงู ุจุฑูุฏู ุงูุฅููุชุฑูููุ ูุฑูู ูุงุชูู.
- ุนูุฏ ูุดุฑ ุฅุนูุงู: ูุฌูุน ุชูุงุตูู ุงูุฌูุงุฒ ุงูุฐู ุชุนูู ุนููุ ุจูุง ูู ุฐูู ุงูุตูุฑ ูุงูุณุนุฑ ูุงููุตู.
- ุนูุฏ ุชุฑู ูุฑุงุฌุนุฉ: ูุฌูุน ุชููููู ูุงูุชุนููู ุงูุฐู ุชูุชุจู.

ุจ. ุงููุนูููุงุช ุงูุชู ูุฌูุนูุง ุชููุงุฆููุง:
- ูุฏ ูููู ุจุฌูุน ูุนูููุงุช ุบูุฑ ุดุฎุตูุฉ ุญูู ููููุฉ ุชูุงุนูู ูุน ุงูุชุทุจูู ูุชุญุณูู ุฎุฏูุงุชูุง.

2. ููู ูุณุชุฎุฏู ูุนูููุงุชู
ูุณุชุฎุฏู ุงููุนูููุงุช ุงูุชู ูุฌูุนูุง ููุฃุบุฑุงุถ ุงูุชุงููุฉ:
- ูุฅูุดุงุก ูุฅุฏุงุฑุฉ ุญุณุงุจู.
- ูุนุฑุถ ุฅุนูุงูุงุชู ูููุณุชุฎุฏููู ุงูุขุฎุฑูู.
- ูุชูููู ุงูุชูุงุตู ุจูู ุงูุจุงุฆุนูู ูุงููุดุชุฑูู (ุนุจุฑ ุนุฑุถ ุฑูู ุงููุงุชู ูู ุงูุฅุนูุงู).
- ูุชุญุณูู ูุชุฎุตูุต ุชุฌุฑุจุฉ ุงุณุชุฎุฏุงู ุงูุชุทุจูู.
- ูุฅุฏุงุฑุฉ ูุธุงู ุงูุชููููุงุช ูุงููุฑุงุฌุนุงุช.
- ูุฅุฑุณุงู ุฅุดุนุงุฑุงุช ูุงูุฉ ุชุชุนูู ุจุญุณุงุจู ุฃู ุฎุฏูุงุชูุง.

3. ูุดุงุฑูุฉ ุงููุนูููุงุช
ูุญู ูุง ูุจูุน ุฃู ูุคุฌุฑ ูุนูููุงุชู ุงูุดุฎุตูุฉ ูุฃุทุฑุงู ุซุงูุซุฉ. ูุฏ ูุดุงุฑู ูุนูููุงุชู ูู ุงูุญุงูุงุช ุงูุชุงููุฉ ููุท:
- ูุน ุงููุณุชุฎุฏููู ุงูุขุฎุฑูู: ูุชู ุนุฑุถ ุงุณูู ูุฑูู ูุงุชูู ุงูููุฌูุฏ ูู ุงูุฅุนูุงู ูููุณุชุฎุฏููู ุงูุขุฎุฑูู ูุชุณููู ุนูููุฉ ุงูุจูุน ูุงูุดุฑุงุก.
- ูุน ูุฒูุฏู ุงูุฎุฏูุงุช: ูุณุชุฎุฏู ุฎุฏูุงุช ุทุฑู ุซุงูุซ ูุซู Supabase ูุชูููุฑ ุงูุจููุฉ ุงูุชุญุชูุฉ ููุชุทุจูู. ูุคูุงุก ุงููุฒูุฏูู ููุฒููู ุจุงูุญูุงุธ ุนูู ุณุฑูุฉ ูุนูููุงุชู.
- ูุฃุณุจุงุจ ูุงููููุฉ: ุฅุฐุง ุทููุจ ููุง ุฐูู ุจููุฌุจ ุฃูุฑ ูุถุงุฆู ุฃู ููุงูุชุซุงู ููููุงููู ุงููุนููู ุจูุง.

4. ุฃูุงู ุงูุจูุงูุงุช
ูุชุฎุฐ ุฅุฌุฑุงุกุงุช ุฃูููุฉ ูุนูููุฉ ูุญูุงูุฉ ูุนูููุงุชู ูู ุงููุตูู ุบูุฑ ุงููุตุฑุญ ุจู ุฃู ุงูุชุบููุฑ ุฃู ุงููุดู. ููุน ุฐููุ ูุง ุชูุฌุฏ ุทุฑููุฉ ููู ุนุจุฑ ุงูุฅูุชุฑูุช ุฃู ุชุฎุฒูู ุฅููุชุฑููู ุขููุฉ ุจูุณุจุฉ 100%.

5. ุญูููู
ูุฏูู ุงูุญู ูู ุงููุตูู ุฅูู ูุนูููุงุชู ุงูุดุฎุตูุฉ ูุชุญุฏูุซูุง ูู ุฃู ููุช ูู ุฎูุงู ุดุงุดุฉ "ุฅุนุฏุงุฏุงุช ุงูุญุณุงุจ". ููููู ุฃูุถูุง ุญุฐู ุญุณุงุจู ุจุงููุงููุ ููุง ุณูุคุฏู ุฅูู ุญุฐู ุจูุงูุงุชู ุงููุฑุชุจุทุฉ ุจู.

6. ุงูุชุบููุฑุงุช ุนูู ูุฐู ุงูุณูุงุณุฉ
ูุฏ ูููู ุจุชุญุฏูุซ ุณูุงุณุฉ ุงูุฎุตูุตูุฉ ูุฐู ูู ููุช ูุขุฎุฑ. ุณูุชู ุฅุนูุงูู ุจุฃู ุชุบููุฑุงุช ุนู ุทุฑูู ูุดุฑ ุงูุณูุงุณุฉ ุงูุฌุฏูุฏุฉ ุฏุงุฎู ุงูุชุทุจูู.

7. ุงุชุตู ุจูุง
ุฅุฐุง ูุงู ูุฏูู ุฃู ุฃุณุฆูุฉ ุญูู ุณูุงุณุฉ ุงูุฎุตูุตูุฉ ูุฐูุ ูุฑุฌู ุงูุชูุงุตู ูุนูุง.
''',
                    )),
                  ),
                  _buildNavigationItem(
                    icon: Icons.help_outline,
                    title: 'ุงููุณุงุนุฏุฉ',
                    onTap: () => _navigateTo(const ComingSoonScreen(featureName: 'ุงููุณุงุนุฏุฉ')),
                  ),
                  _buildNavigationItem(
                    icon: Icons.info_outline,
                    title: 'ุนู ุงูุชุทุจูู',
                    onTap: () => _navigateTo(const ComingSoonScreen(featureName: 'ุนู ุงูุชุทุจูู')),
                  ),
                ],
              ),
              const SizedBox(height: 24),
              _buildLogoutButton(),
            ],
          ),
        ),
      ),
    );
  }

  Widget _buildSettingsSection({required List<Widget> items}) {
    return Card(
      child: Column(children: items),
    );
  }

  Widget _buildNavigationItem(
      {required IconData icon, required String title, required VoidCallback onTap}) {
    return ListTile(
      leading: Icon(icon, color: Theme.of(context).colorScheme.primary),
      title: Text(title),
      trailing: const Icon(Icons.arrow_forward_ios, size: 16),
      onTap: onTap,
    );
  }

  Widget _buildSwitchItem(
      {required IconData icon,
      required String title,
      required bool value,
      required ValueChanged<bool> onChanged}) {
    return SwitchListTile(
      secondary: Icon(icon, color: Theme.of(context).colorScheme.primary),
      title: Text(title),
      value: value,
      onChanged: onChanged,
    );
  }

  Widget _buildPickerItem(
      {required IconData icon,
      required String title,
      required String value,
      required VoidCallback onTap}) {
    return ListTile(
      leading: Icon(icon, color: Theme.of(context).colorScheme.primary),
      title: Text(title),
      trailing: Row(
        mainAxisSize: MainAxisSize.min,
        children: [
          Text(value, style: TextStyle(color: Colors.grey.shade700)),
          const SizedBox(width: 8),
          const Icon(Icons.arrow_forward_ios, size: 16),
        ],
      ),
      onTap: onTap,
    );
  }

  Widget _buildLogoutButton() {
    return SizedBox(
      width: double.infinity,
      child: TextButton.icon(
        icon: const Icon(Icons.logout),
        label: const Text('ุชุณุฌูู ุงูุฎุฑูุฌ'),
        onPressed: _signOut,
        style: TextButton.styleFrom(
          foregroundColor: Colors.red,
          padding: const EdgeInsets.symmetric(vertical: 12),
        ),
      ),
    );
  }
}